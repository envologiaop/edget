import { NextRequest, NextResponse } from 'next/server'\nimport { auth } from '@/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET() {\n  const session = await auth()\n  if (!session || (session as any).role !== 'ADMIN') return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  const items = await prisma.payment.findMany({ where: { status: 'PENDING' }, include: { tutorRequest: { include: { package: true, teacher: { include: { user: true } }, student: true } } } })\n  return NextResponse.json({ items })\n}\n\nexport async function PATCH(req: NextRequest) {\n  const session = await auth()\n  if (!session || (session as any).role !== 'ADMIN') return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  const { paymentId, confirm } = await req.json()\n  if (!paymentId) return NextResponse.json({ error: 'Missing paymentId' }, { status: 400 })\n  const status = confirm ? 'CONFIRMED' : 'REJECTED'\n  const pay = await prisma.payment.update({ where: { id: paymentId }, data: { status, confirmedById: (session.user as any).id, confirmedAt: new Date() } })\n  if (confirm) {\n    await prisma.booking.create({ data: { tutorRequestId: pay.tutorRequestId, startDate: new Date(), status: 'ACTIVE' } })\n  }\n  return NextResponse.json({ ok: true })\n}\n