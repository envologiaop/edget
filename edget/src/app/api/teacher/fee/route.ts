import { NextRequest, NextResponse } from 'next/server'\nimport { auth } from '@/auth'\nimport { prisma } from '@/lib/prisma'\nimport { uploadFile } from '@/lib/storage'\n\nexport async function POST(req: NextRequest) {\n  const session = await auth()\n  if (!session || (session as any).role !== 'TEACHER') return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  const form = await req.formData()\n  const file = form.get('receipt') as File | null\n  const method = String(form.get('method') || '')\n  const payerDetails = String(form.get('payerDetails') || '')\n  if (!file || !method) return NextResponse.json({ error: 'Missing fields' }, { status: 400 })\n  const buf = Buffer.from(await file.arrayBuffer())\n  const key = `fees/${Date.now()}-${(session.user as any).id}-${file.name}`\n  await uploadFile(buf, key, file.type)\n\n  // amount fixed 100 ETB\n  const teacher = await prisma.teacherProfile.findUnique({ where: { userId: (session.user as any).id } })\n  if (!teacher) return NextResponse.json({ error: 'No teacher profile' }, { status: 400 })\n  const rec = await prisma.teacherFeePayment.create({ data: {\n    teacherId: teacher.id,\n    method,\n    payerDetails,\n    amount: 100,\n    receiptUrl: key,\n  }})\n  return NextResponse.json({ ok: true, id: rec.id })\n}\n